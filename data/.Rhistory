library(stringr)
install.packages('stringr')
install.packages('lubridate')
install.packages('scales')
install.packages('dplyr')
install.packages('ggplot')
install.packages('ggplot2')
install.packages('ggplot2')
source('~/.active-rstudio-document', echo=TRUE)
timeHMS_formatter <- function(x) {
h <- floor(x/60)
m <- floor(x %% 60)
s <- round(60*(x %% 1))                   # Round to nearest second
lab <- sprintf('%02d:%02d', h, m) # Format the strings as HH:MM:SS
lab <- gsub('^00:', '', lab)              # Remove leading 00: if present
lab <- gsub('^0', '', lab)                # Remove leading 0 if present
}
worst_schools <- rawdata %>%
filter(
errortype == '',
!is.na(bell_late),
bell_late > 0
) %>%
group_by(school) %>%
tally() %>%
arrange(desc(n)) %>%
head(1)
worst_schools %>%
select(school) %>%
inner_join(rawdata, by=c('school')) %>%
filter(
errortype == '',
!is.na(bell_late),
!is.na(ActualArrivalTime)
) %>%
mutate(
is.late = bell_late > 0,
date = dmy(date),
ActualArrivalTime = hm(ActualArrivalTime)/hours(1)
) %>%
ggplot(aes(date, ActualArrivalTime, color=is.late, size=is.late)) +
geom_point() +
facet_grid(school ~ ., scales='free_y') +
scale_colour_manual(values=c('grey70', '#ea212d')) +
scale_size_manual(values=c(0.75, 0.9)) +
theme(legend.position='none') +
ylab('arrival') +
#  scale_y_continuous(label=timeHMS_formatter) +
ggtitle('Late arrivals (in red) at worst schools')
timeHMS_formatter <- function(x) {
h <- floor(x/60)
m <- floor(x %% 60)
s <- round(60*(x %% 1))                   # Round to nearest second
lab <- sprintf('%02d:%02d', h, m) # Format the strings as HH:MM:SS
lab <- gsub('^00:', '', lab)              # Remove leading 00: if present
lab <- gsub('^0', '', lab)                # Remove leading 0 if present
}
worst_schools <- rawdata %>%
filter(
errortype == '',
!is.na(bell_late),
bell_late > 0
) %>%
group_by(school) %>%
tally() %>%
arrange(desc(n)) %>%
head(1)
worst_schools %>%
select(school) %>%
inner_join(rawdata, by=c('school')) %>%
filter(
errortype == '',
!is.na(bell_late),
!is.na(ActualArrivalTime)
) %>%
mutate(
is.late = bell_late > 0,
is
date = dmy(date),
ActualArrivalTime = hm(ActualArrivalTime)/hours(1)
) %>%
ggplot(aes(date, ActualArrivalTime, color=is.late, size=is.late)) +
geom_point() +
facet_grid(school ~ ., scales='free_y') +
scale_colour_manual(values=c('grey70', '#ea212d')) +
scale_size_manual(values=c(0.75, 0.9)) +
theme(legend.position='none') +
ylab('arrival') +
ggtitle('Late arrivals (in red) at worst schools')
timeHMS_formatter <- function(x) {
h <- floor(x/60)
m <- floor(x %% 60)
s <- round(60*(x %% 1))                   # Round to nearest second
lab <- sprintf('%02d:%02d', h, m) # Format the strings as HH:MM:SS
lab <- gsub('^00:', '', lab)              # Remove leading 00: if present
lab <- gsub('^0', '', lab)                # Remove leading 0 if present
}
worst_schools <- rawdata %>%
filter(
errortype == '',
!is.na(bell_late),
bell_late > 0
) %>%
group_by(school) %>%
tally() %>%
arrange(desc(n)) %>%
head(1)
worst_schools %>%
select(school) %>%
inner_join(rawdata, by=c('school')) %>%
filter(
errortype == '',
!is.na(bell_late),
!is.na(ActualArrivalTime)
) %>%
mutate(
is.late = bell_late > 0,
date = dmy(date),
ActualArrivalTime = hm(ActualArrivalTime)/hours(1)
) %>%
ggplot(aes(date, ActualArrivalTime, color=is.late, size=is.late)) +
geom_point() +
facet_grid(school ~ ., scales='free_y') +
scale_colour_manual(values=c('grey70', '#ea212d')) +
scale_size_manual(values=c(0.75, 0.9)) +
theme(legend.position='none') +
ylab('arrival') +
ggtitle('Late arrivals (in red) at worst schools')
timeHMS_formatter <- function(x) {
h <- floor(x/60)
m <- floor(x %% 60)
s <- round(60*(x %% 1))                   # Round to nearest second
lab <- sprintf('%02d:%02d', h, m) # Format the strings as HH:MM:SS
lab <- gsub('^00:', '', lab)              # Remove leading 00: if present
lab <- gsub('^0', '', lab)                # Remove leading 0 if present
}
worst_schools <- rawdata %>%
filter(
errortype == '',
!is.na(bell_late),
bell_late > 0
) %>%
group_by(school) %>%
tally() %>%
arrange(desc(n)) %>%
head(1)
worst_schools %>%
select(school) %>%
inner_join(rawdata, by=c('school')) %>%
filter(
errortype == '',
!is.na(belltime),
!is.na(bell_late),
!is.na(ActualArrivalTime)
) %>%
mutate(
ten_late = ((hm(ActualArrivalTime) - hm(belltime))/minutes(1) + 10),
is.ten.late = ten_late > 0,
is.late = bell_late > 0,
date = dmy(date),
ActualArrivalTime = hm(ActualArrivalTime)/hours(1)
) %>%
ggplot(aes(date, ActualArrivalTime, color=is.ten.late, size=is.ten.late)) +
geom_point() +
facet_grid(school ~ ., scales='free_y') +
scale_colour_manual(values=c('grey70', '#ea212d')) +
scale_size_manual(values=c(0.75, 0.9)) +
theme(legend.position='none') +
ylab('arrival') +
ggtitle('Late arrivals (in red) at worst schools')
timeHMS_formatter <- function(x) {
h <- floor(x/60)
m <- floor(x %% 60)
s <- round(60*(x %% 1))                   # Round to nearest second
lab <- sprintf('%02d:%02d', h, m) # Format the strings as HH:MM:SS
lab <- gsub('^00:', '', lab)              # Remove leading 00: if present
lab <- gsub('^0', '', lab)                # Remove leading 0 if present
}
worst_schools <- rawdata %>%
filter(
errortype == '',
!is.na(bell_late),
bell_late > 0
) %>%
group_by(school) %>%
tally() %>%
arrange(desc(n)) %>%
head(1)
worst_schools %>%
select(school) %>%
inner_join(rawdata, by=c('school')) %>%
filter(
errortype == '',
!is.na(belltime),
!is.na(bell_late),
!is.na(ActualArrivalTime)
) %>%
mutate(
ten_late = ((hm(ActualArrivalTime) - hm(belltime))/minutes(1) + 10),
is.ten.late = ten_late > 0,
is.late = bell_late > 0,
date = dmy(date),
ActualArrivalTime = hm(ActualArrivalTime)/hours(1)
) %>%
ggplot(aes(date, ActualArrivalTime, color=is.ten.late, size=is.ten.late)) +
geom_point() +
facet_grid(school ~ ., scales='free_y') +
scale_colour_manual(values=c('grey70', '#ea212d')) +
scale_size_manual(values=c(0.75, 0.9)) +
theme(legend.position='none') +
ylab('arrival')
timeHMS_formatter <- function(x) {
h <- floor(x/60)
m <- floor(x %% 60)
s <- round(60*(x %% 1))                   # Round to nearest second
lab <- sprintf('%02d:%02d', h, m) # Format the strings as HH:MM:SS
lab <- gsub('^00:', '', lab)              # Remove leading 00: if present
lab <- gsub('^0', '', lab)                # Remove leading 0 if present
}
worst_schools <- rawdata %>%
filter(
errortype == '',
!is.na(bell_late),
bell_late > 0
) %>%
group_by(school) %>%
tally() %>%
arrange(desc(n)) %>%
head(1)
worst_schools %>%
select(school) %>%
inner_join(rawdata, by=c('school')) %>%
filter(
errortype == '',
!is.na(belltime),
!is.na(bell_late),
!is.na(ActualArrivalTime)
) %>%
mutate(
ten_late = ((hm(ActualArrivalTime) - hm(belltime))/minutes(1) + 10),
is.ten.late = ten_late > 0,
is.late = bell_late > 0,
date = dmy(date),
ActualArrivalTime = hm(ActualArrivalTime)/hours(1)
) %>%
ggplot(aes(date, ActualArrivalTime, color=is.late, size=is.late)) +
geom_point() +
facet_grid(school ~ ., scales='free_y') +
scale_colour_manual(values=c('grey70', '#ea212d')) +
scale_size_manual(values=c(0.75, 0.9)) +
theme(legend.position='none') +
ylab('arrival')
timeHMS_formatter <- function(x) {
h <- floor(x/60)
m <- floor(x %% 60)
s <- round(60*(x %% 1))                   # Round to nearest second
lab <- sprintf('%02d:%02d', h, m) # Format the strings as HH:MM:SS
lab <- gsub('^00:', '', lab)              # Remove leading 00: if present
lab <- gsub('^0', '', lab)                # Remove leading 0 if present
}
worst_schools <- rawdata %>%
filter(
errortype == '',
!is.na(bell_late),
bell_late > 0
) %>%
group_by(school) %>%
tally() %>%
arrange(desc(n)) %>%
head(10)
worst_schools %>%
select(school) %>%
inner_join(rawdata, by=c('school')) %>%
filter(
errortype == '',
!is.na(belltime),
!is.na(bell_late),
!is.na(ActualArrivalTime)
) %>%
mutate(
ten_late = ((hm(ActualArrivalTime) - hm(belltime))/minutes(1) + 10),
is.ten.late = ten_late > 0,
is.late = bell_late > 0,
date = dmy(date),
ActualArrivalTime = hm(ActualArrivalTime)/hours(1)
) %>%
ggplot(aes(date, ActualArrivalTime, color=is.late, size=is.late)) +
geom_point() +
facet_grid(school ~ ., scales='free_y') +
scale_colour_manual(values=c('grey70', '#ea212d')) +
scale_size_manual(values=c(0.75, 0.9)) +
theme(legend.position='none') +
ylab('arrival')
worst_schools <- rawdata %>%
filter(
errortype == '',
!is.na(bell_late),
bell_late > 30
) %>%
group_by(school) %>%
tally() %>%
arrange(desc(n)) %>%
head(10)
worst_schools
worst_schools <- rawdata %>%
filter(
errortype == '',
!is.na(bell_late),
bell_late > 29
) %>%
group_by(school) %>%
tally() %>%
arrange(desc(n)) %>%
head(10)
worst_schools
worst_schools <- rawdata %>%
filter(
errortype == '',
!is.na(bell_late),
bell_late > 29
) %>%
group_by(school) %>%
summarise(count = n(), students_late = sum(students)) %>%
arrange(desc(count)) %>%
head(10)
worst_schools
sum(worst_schools$students_late)
worst_schools <- rawdata %>%
filter(
errortype == '',
!is.na(bell_late),
bell_late > 9
) %>%
group_by(school) %>%
summarise(count = n(), students_late = sum(students)) %>%
arrange(desc(count)) %>%
head(10)
sum(worst_schools$students_late)
worst_schools <- rawdata %>%
filter(
errortype == '',
!is.na(bell_late),
bell_late > 0
) %>%
group_by(school) %>%
summarise(count = n(), students_late = sum(students)) %>%
arrange(desc(count)) %>%
head(10)
sum(worst_schools$students_late)
sum(worst_schools$n)
sum(worst_schools$count)
worst_schools <- rawdata %>%
filter(
errortype == '',
!is.na(bell_late),
bell_late > 0
) %>%
group_by(school) %>%
summarise(count = n(), students_late = sum(students)) %>%
arrange(desc(count))
sum(worst_schools$count)
worst_schools <- rawdata %>%
filter(
errortype == '',
!is.na(bell_late),
bell_late > 0
) %>%
group_by(school) %>%
summarise(count = n(), students_late = sum(students)) %>%
arrange(desc(count))
sum(worst_schools$students_late)
worst_schools <- rawdata %>%
filter(
errortype == '',
!is.na(bell_late),
bell_late > 29
) %>%
group_by(school) %>%
summarise(count = n(), students_late = sum(students)) %>%
arrange(desc(count))
sum(worst_schools$students_late)
worst_schools <- rawdata %>%
filter(
errortype == '',
!is.na(bell_late),
bell_late > 0
) %>%
group_by(school) %>%
summarise(count = n(), students_late = sum(students)) %>%
arrange(desc(count))
sum(worst_schools$count)
19018/175
unique(rawdata$date)
rawdata %>%
filter(
errortype == '') %>%
unique(date)
rawdata %>%
filter(errortype == '')
rawdata %>%
filter(errortype == '') %>%
head()
rawdata %>%
filter(errortype == '') %>%
group_by(date) %>%
tally()
